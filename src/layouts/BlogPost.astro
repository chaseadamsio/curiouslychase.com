---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import TableOfContents from "../components/TableOfContents";
import generateTOC from "../utils/generateTOC";
import { ShareLinkOnTwitter } from "../components/ShareOnTwitter";
import { SITE_URL } from "../consts";

type Props = CollectionEntry<"posts">["data"];

const {
	frontmatter: { title, description, pubDate, updatedDate, heroImage, slug },
	headings = [],
} = Astro.props;

const permalink = `${SITE_URL}/posts/${slug}/`;
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			.title {
				font-size: 2em;
				margin: 0.25em 0 0;
			}
			hr {
				border-top: 1px solid #ddd;
				margin: 1rem 0;
			}
			.last-updated-on {
				font-style: italic;
			}
		</style>
	</head>

	<body>
		<Header />
		<main class="max-w-5xl mx-auto">
			<article>
				{heroImage && <img width={720} height={360} src={heroImage} alt="" />}
				<div class="lg:w-8/12">
					<h1 class="text-4xl" id="overview">{title}</h1>
					<div class="pt-4 text-xs flex flex-row gap-4 font-mono">
						{
							pubDate && (
								<div>
									Published on <FormattedDate date={pubDate} />
								</div>
							)
						}
						{
							updatedDate && (
								<div>
									Last updated on <FormattedDate date={updatedDate} />
								</div>
							)
						}
					</div>
					<div class="pt-2">
						<ShareLinkOnTwitter
							client:load
							title={title}
							permalink={permalink}
						/>
					</div>
					<hr class="pt-4 pb-8" />
				</div>
				<div class="flex flex-col gap-8 lg:flex-row-reverse lg:gap-12">
					<nav class="lg:sticky lg:self-start lg:top-4 text-sm lg:w-4/12">
						<TableOfContents
							labels={{ onThisPage: "Table of Contents" }}
							toc={generateTOC(headings)}
						/>
					</nav>
					<div class="article w-full lg:w-8/12">
						<slot />
					</div>
				</div>
			</article>
			<ShareLinkOnTwitter client:load title={title} permalink={permalink} />
		</main>
		<Footer />
		<style>
			nav {
				width: 100%;
				padding: var(--doc-padding-block) 0;
				overflow: auto;
				font-size: var(--theme-text-xs);
			}
		</style>
	</body>
</html>
